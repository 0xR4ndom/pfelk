# 46-networks.conf
################################################################################
# Version: 21.01-Beta                                                          #
# Enrichs networks                                                             #
#                                                                              #
#                                                                              #
################################################################################
#
filter {
#########################################    
### Enrich network based on source.ip ###
#########################################    
  if [source][ip] {
    cidr {
      address => [ "%{[source][ip]}" ]
      network => [ "192.168.0.0/24" ]
      add_field => { "[network][name]" => "Guest Network" }
      add_field => { "[network][vlan][id]" => "0" }
      add_field => { "[network][vlan][name]" => "NONE" }
    }
    cidr {
      address => [ "%{[source][ip]}" ]
      network => [ "10.0.0.0/16" ]
      add_field => { "[network][name]" => "DMZ" }
      add_field => { "[network][vlan][id]" => "0" }
      add_field => { "[network][vlan][name]" => "NONE" }
    }
    cidr {
      address => [ "%{[source][ip]}" ]
      network => [ "172.22.33.0/24" ]
      add_field => { "[network][name]" => "Home Lab" }
      add_field => { "[network][vlan][id]" => "0" }
      add_field => { "[network][vlan][name]" => "NONE" }
    }
    cidr {
      address => [ "%{[source][ip]}" ]
      network => [ "192.168.1.0/24" ]
      add_field => { "[network][name]" => "VLAN11 - Secure" }
      add_field => { "[network][vlan][id]" => "11" }
      add_field => { "[network][vlan][name]" => "SECURE" }
    }
  }
 ##############################################   
 ### Enrich network based on destination.ip ### 
 ##############################################  
  if [destination][ip] {
    cidr {
      address => [ "%{[destination][ip]}" ]
      network => [ "192.168.0.0/24" ]
      add_field => { "[network][name]" => "Guest Network" }
      add_field => { "[network][vlan][id]" => "0" }
      add_field => { "[network][vlan][name]" => "NONE" }
    }
    cidr {
      address => [ "%{[destination][ip]}" ]
      network => [ "10.0.0.0/16" ]
      add_field => { "[network][name]" => "DMZ" }
      add_field => { "[network][vlan][id]" => "0" }
      add_field => { "[network][vlan][name]" => "NONE" }
    }
    cidr {
      address => [ "%{[destination][ip]}" ]
      network => [ "172.22.33.0/24" ]
      add_field => { "[network][name]" => "Home Lab" }
      add_field => { "[network][vlan][id]" => "0" }
      add_field => { "[network][vlan][name]" => "NONE" }
    }
    cidr {
      address => [ "%{[destination][ip]}" ]
      network => [ "192.168.1.0/24" ]
      add_field => { "[network][name]" => "VLAN11 - Secure" }
      add_field => { "[network][vlan][id]" => "11" }
      add_field => { "[network][vlan][name]" => "SECURE" }
    }
  }
#########################################    
### Enrich network based on client.ip ###
#########################################    
  if [source][ip] {
    cidr {
      address => [ "%{[client][ip]}" ]
      network => [ "192.168.0.0/24" ]
      add_field => { "[network][name]" => "Guest Network" }
      add_field => { "[network][vlan][id]" => "0" }
      add_field => { "[network][vlan][name]" => "NONE" }
    }
    cidr {
      address => [ "%{[client][ip]}" ]
      network => [ "10.0.0.0/16" ]
      add_field => { "[network][name]" => "DMZ" }
      add_field => { "[network][vlan][id]" => "0" }
      add_field => { "[network][vlan][name]" => "NONE" }
    }
    cidr {
      address => [ "%{[client][ip]}" ]
      network => [ "172.22.33.0/24" ]
      add_field => { "[network][name]" => "Home Lab" }
      add_field => { "[network][vlan][id]" => "0" }
      add_field => { "[network][vlan][name]" => "NONE" }
    }
    cidr {
      address => [ "%{[client][ip]}" ]
      network => [ "192.168.1.0/24" ]
      add_field => { "[network][name]" => "VLAN11 - Secure" }
      add_field => { "[network][vlan][id]" => "11" }
      add_field => { "[network][vlan][name]" => "SECURE" }
    }
  }
}
#############################################################################  
### Enrich network, defaults to the following if the above does not match ### 
#############################################################################    
filter {
  if ![network][name] {
    mutate { 
      add_field => { "[network][name]" => "ISP - Outside" }  
      add_field => { "[network][vlan][id]" => "0" }
      add_field => { "[network][vlan][name]" => "NONE" }
    }    
  } 
}
