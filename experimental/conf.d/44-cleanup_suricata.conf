# 44-cleanup_suricata.conf
################################################################################
# Version: 21.01-Beta                                                          #
# Surcata Clean-up                                                             #
# 																												                     #
#         																								                     #
################################################################################
#
filter {
#####################
### Final message ###
#####################
  if [rule][id] {
    mutate {
      replace => { "[message]" => "[Suricata]: %{[rule][id]} - %{[rule][name]}" }
      replace => { "[related][id]" => "%{[rule][id]}" }
    }
  }
############################
### Final ECS Conversion ###
############################
  # Client Schema to Source Schema
  if [client] {
    mutate {
      copy => { "[client][address]" => "[client][domain]" } 
    } 
    mutate { 
      copy => { "[client]" => "[source]" } 
    }
  }
  # Server Schema to Destination Schema
  if [server] {
    mutate {
      copy => { "[server][address]" => "[server][domain]" } 
    } 
    mutate { 
      copy => { "[server]" => "[destination]" }
    }
  }
  if [@metadata][destination_domain] {
    mutate {
      add_field => {
        "[related][domain]" => "%{[@metadata][destination_domain]}"
        "[related][ip]" => "%{[client][ip]}"
      }
    }
  }
###############################
### Cleanup metadata object ###
###############################
  mutate {
    remove_field => [ 
      "[metadata]",
      "[@version]",
      "[src_ip]",
      "[dest_ip]",
      "[src_port]",
      "[dest_port]",
      "[tx_id]",
      "[in_iface]",
      "[error]",
      "[suricata][eve][http][content_range]"
    ]
    remove_tag => [ "_geoip_lookup_failure]" ]
  }
}
