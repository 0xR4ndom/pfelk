# 49-enhanced_private.conf
################################################################################
# Version: 21.01                                                               #
# Adds customized host.hostname via dictionary lookup with domain              #
# Adds cusotmiazed GeoIP data for local IP address                             #
#                                                                              #
################################################################################
#
filter {
  if "dhcp" in [tags] or "unbound" in [tags] or "squid" in [tags] {
    translate {
      field => "[client][ip]"
      destination => "[host][hostname]"
      ### Edit referenced dictionary for local IP/Hostnames ### 
      dictionary_path => "/etc/logstash/conf.d/databases/private-hostnames.csv"
      refresh_interval => 600
      refresh_behaviour => replace
      fallback => "%{[client][ip]}"
    }
    cidr {
      address => [ "%{[client][ip]}" ]
      network => [ "10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16", "fc00::/7", "169.254.0.0/16", "fe80::/10", "ff00::/8" ]
      add_tag => "Private_Client_IP"
    }
    if "Private_Client_IP" in [tags] {
      mutate {
        ### Amend 3ilson.dev to your own domain name ###
        replace => { "[host][name]" => "%{[host][hostname]}.3ilson.dev" }
        add_field => {   
          "[client][as][organization][name]" => "3ilson"
          "[client][geo][location]" => "32.309,-64.813" 
          "[client][geo][city_name]" => "City" 
          "[client][geo][country_name]" => "Country"
          "[client][geo][region_name]" => "State"
        }
        lowercase => [ "[host][hostname]" ]
        lowercase => [ "[host][host]" ]
      }
    }
    mutate {
      remove_tag => [ "Private_Client_IP" ]
    }
  }
}
